
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>flaskr.admin &#8212; CloudCar 0.0.1 documentation</title>
    <link rel="stylesheet" href="../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for flaskr.admin</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python3</span>
<span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">admin.py contains the control logic for all pages for user_type=Admin</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Blueprint</span><span class="p">,</span> <span class="n">flash</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">redirect</span>
<span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">render_template</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">url_for</span><span class="p">,</span> <span class="n">session</span>
<span class="kn">from</span> <span class="nn">.auth</span> <span class="kn">import</span> <span class="n">login_required</span>
<span class="kn">from</span> <span class="nn">.forms</span> <span class="kn">import</span> <span class="n">AdminCarSearchForm</span><span class="p">,</span> <span class="n">AdminUserSearchForm</span><span class="p">,</span> <span class="n">RegisterForm</span><span class="p">,</span> <span class="n">AdminUpdateUserForm</span><span class="p">,</span> <span class="n">AdminCreateCarForm</span><span class="p">,</span> <span class="n">AdminUpdateCarForm</span><span class="p">,</span> <span class="n">NewBacklogForm</span>
<span class="kn">from</span> <span class="nn">flaskr.model.car</span> <span class="kn">import</span> <span class="n">Car</span>
<span class="kn">from</span> <span class="nn">flaskr.model.account</span> <span class="kn">import</span> <span class="n">Account</span>
<span class="kn">from</span> <span class="nn">flaskr.model.booking</span> <span class="kn">import</span> <span class="n">Booking</span>
<span class="kn">from</span> <span class="nn">email.mime.text</span> <span class="kn">import</span> <span class="n">MIMEText</span>
<span class="kn">from</span> <span class="nn">email.mime.multipart</span> <span class="kn">import</span> <span class="n">MIMEMultipart</span>
<span class="kn">from</span> <span class="nn">.auth</span> <span class="kn">import</span> <span class="n">login_required</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">smtplib</span>

<span class="n">admin</span> <span class="o">=</span> <span class="n">Blueprint</span><span class="p">(</span><span class="s2">&quot;admin&quot;</span><span class="p">,</span> <span class="vm">__name__</span><span class="p">)</span>

<div class="viewcode-block" id="user_view"><a class="viewcode-back" href="../../User%20Interface.html#flaskr.admin.user_view">[docs]</a><span class="nd">@admin</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s2">&quot;/users&quot;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="s2">&quot;POST&quot;</span><span class="p">))</span>
<span class="nd">@login_required</span>
<span class="k">def</span> <span class="nf">user_view</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is the user search function for Admin users. If you access it via GET request, we assume you are arriving for the first time and display a search form with no listed users. If you access it via POST request, we assume you&#39;ve completed the search form and instead return both the search form and a table with results. Only Admin has access.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">type</span> <span class="o">!=</span> <span class="s2">&quot;Admin&quot;</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;Access Denied&quot;</span>
    <span class="n">form</span> <span class="o">=</span> <span class="n">AdminUserSearchForm</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;POST&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">search_user</span><span class="p">(</span><span class="n">form</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;GET&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">display_all_users</span><span class="p">(</span><span class="n">form</span><span class="p">)</span></div>

<div class="viewcode-block" id="search_user"><a class="viewcode-back" href="../../User%20Interface.html#flaskr.admin.search_user">[docs]</a><span class="k">def</span> <span class="nf">search_user</span><span class="p">(</span><span class="n">form</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This is the control logic that receives data from WTForms and returns users.&quot;&quot;&quot;</span>
    <span class="n">username</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="n">firstname</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s1">&#39;firstname&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="n">lastname</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s1">&#39;lastname&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="n">phone</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s1">&#39;phone&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="n">email</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s1">&#39;email&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="n">user_type</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s1">&#39;user_type&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="n">users</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">validate_search_input</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">phone</span><span class="p">,</span> <span class="n">email</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">user_type</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="n">users</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;http://127.0.0.1:8080/customers/read?username=</span><span class="si">{}</span><span class="s2">&amp;first_name=</span><span class="si">{}</span><span class="s2">&amp;last_name=</span><span class="si">{}</span><span class="s2">&amp;email=</span><span class="si">{}</span><span class="s2">&amp;phone=</span><span class="si">{}</span><span class="s2">&quot;</span>
                <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">firstname</span><span class="p">,</span> <span class="n">lastname</span><span class="p">,</span> <span class="n">email</span><span class="p">,</span> <span class="n">phone</span><span class="p">))</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
            <span class="n">staffs</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;http://127.0.0.1:8080/staffs/read?username=</span><span class="si">{}</span><span class="s2">&amp;first_name=</span><span class="si">{}</span><span class="s2">&amp;last_name=</span><span class="si">{}</span><span class="s2">&amp;email=</span><span class="si">{}</span><span class="s2">&amp;phone=</span><span class="si">{}</span><span class="s2">&amp;user_type=</span><span class="si">{}</span><span class="s2">&quot;</span>
                <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">firstname</span><span class="p">,</span> <span class="n">lastname</span><span class="p">,</span> <span class="n">email</span><span class="p">,</span> <span class="n">phone</span><span class="p">,</span> <span class="n">user_type</span><span class="p">))</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
            <span class="n">users</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">staffs</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">user_type</span> <span class="o">==</span> <span class="s2">&quot;customer&quot;</span><span class="p">:</span>
            <span class="n">users</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;http://127.0.0.1:8080/customers/read?username=</span><span class="si">{}</span><span class="s2">&amp;first_name=</span><span class="si">{}</span><span class="s2">&amp;last_name=</span><span class="si">{}</span><span class="s2">&amp;email=</span><span class="si">{}</span><span class="s2">&amp;phone=</span><span class="si">{}</span><span class="s2">&quot;</span>
                <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">firstname</span><span class="p">,</span> <span class="n">lastname</span><span class="p">,</span> <span class="n">email</span><span class="p">,</span> <span class="n">phone</span><span class="p">))</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">user_type</span> <span class="o">==</span> <span class="s2">&quot;admin&quot;</span> <span class="ow">or</span> <span class="n">user_type</span> <span class="o">==</span> <span class="s2">&quot;manager&quot;</span> <span class="ow">or</span> <span class="n">user_type</span> <span class="o">==</span> <span class="s2">&quot;engineer&quot;</span><span class="p">:</span>
            <span class="n">users</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;http://127.0.0.1:8080/staffs/read?username=</span><span class="si">{}</span><span class="s2">&amp;first_name=</span><span class="si">{}</span><span class="s2">&amp;last_name=</span><span class="si">{}</span><span class="s2">&amp;email=</span><span class="si">{}</span><span class="s2">&amp;phone=</span><span class="si">{}</span><span class="s2">&amp;user_type=</span><span class="si">{}</span><span class="s2">&quot;</span>
                <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">firstname</span><span class="p">,</span> <span class="n">lastname</span><span class="p">,</span> <span class="n">email</span><span class="p">,</span> <span class="n">phone</span><span class="p">,</span> <span class="n">user_type</span><span class="p">))</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
        <span class="c1"># all in the search box will return all the tuples</span>
        <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s2">&quot;admin/user_view.html&quot;</span><span class="p">,</span> <span class="n">users</span><span class="o">=</span><span class="n">users</span><span class="p">,</span> <span class="n">form</span><span class="o">=</span><span class="n">form</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">display_all_users</span><span class="p">(</span><span class="n">form</span><span class="p">)</span></div>

<div class="viewcode-block" id="validate_search_input"><a class="viewcode-back" href="../../User%20Interface.html#flaskr.admin.validate_search_input">[docs]</a><span class="k">def</span> <span class="nf">validate_search_input</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">phone</span><span class="p">,</span> <span class="n">email</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is the validation logic for the user search form. We check username and phone number against a regex if they exist.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">username</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">Account</span><span class="o">.</span><span class="n">validate_username_input</span><span class="p">(</span><span class="n">username</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="n">phone</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">Account</span><span class="o">.</span><span class="n">validate_phone_input</span><span class="p">(</span><span class="n">phone</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="display_all_users"><a class="viewcode-back" href="../../User%20Interface.html#flaskr.admin.display_all_users">[docs]</a><span class="k">def</span> <span class="nf">display_all_users</span><span class="p">(</span><span class="n">form</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;If no search fields are filled, we show all users with this function.&quot;&quot;&quot;</span>
    <span class="n">users</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;http://127.0.0.1:8080/customers/read?&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
    <span class="n">staffs</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;http://127.0.0.1:8080/staffs/read?&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
    <span class="n">users</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">staffs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s2">&quot;admin/user_view.html&quot;</span><span class="p">,</span> <span class="n">users</span><span class="o">=</span><span class="n">users</span><span class="p">,</span> <span class="n">form</span><span class="o">=</span><span class="n">form</span><span class="p">)</span></div>

<div class="viewcode-block" id="update_user"><a class="viewcode-back" href="../../User%20Interface.html#flaskr.admin.update_user">[docs]</a><span class="nd">@admin</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s2">&quot;/update/user&quot;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="s2">&quot;POST&quot;</span><span class="p">))</span>
<span class="nd">@login_required</span>
<span class="k">def</span> <span class="nf">update_user</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;This page provides a form for the admin user to update users on GET. On POST, it updates the user instead. Parameters:</span>
<span class="sd">    </span>
<span class="sd">    user_id: The id of the user</span>
<span class="sd">    user_type: The type of the user, e.g. engineer</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">type</span> <span class="o">!=</span> <span class="s2">&quot;Admin&quot;</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;Access Denied&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">user_type</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;user_type&quot;</span><span class="p">]</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">user_type</span> <span class="o">=</span> <span class="s2">&quot;customers&quot;</span>
    <span class="n">form</span> <span class="o">=</span> <span class="n">AdminUpdateUserForm</span><span class="p">()</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">user_type</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;user_type&quot;</span><span class="p">]</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">user_type</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;POST&quot;</span><span class="p">:</span>
        <span class="n">username</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s2">&quot;username&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="n">password</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s2">&quot;password&quot;</span><span class="p">]</span>
        <span class="n">firstname</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s2">&quot;firstname&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="n">lastname</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s2">&quot;lastname&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="n">email</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s2">&quot;email&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="n">phone</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s2">&quot;phone&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="n">mac_address</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s2">&quot;mac_address&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="n">account</span> <span class="o">=</span> <span class="n">Account</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">,</span> <span class="n">email</span><span class="p">,</span> <span class="n">firstname</span><span class="p">,</span> <span class="n">lastname</span><span class="p">,</span> <span class="n">phone</span><span class="p">,</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;user_id&quot;</span><span class="p">],</span> <span class="n">mac_address</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">account</span><span class="o">.</span><span class="n">validate_update_account</span><span class="p">():</span>
            <span class="n">account</span><span class="o">.</span><span class="n">update_account</span><span class="p">(</span><span class="n">user_type</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s2">&quot;admin.user_view&quot;</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s2">&quot;admin/update_user.html&quot;</span><span class="p">,</span> <span class="n">user_id</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;user_id&quot;</span><span class="p">],</span> <span class="n">user_type</span><span class="o">=</span><span class="n">user_type</span><span class="p">,</span> <span class="n">form</span><span class="o">=</span><span class="n">form</span><span class="p">)</span></div>
        
<div class="viewcode-block" id="delete_user"><a class="viewcode-back" href="../../User%20Interface.html#flaskr.admin.delete_user">[docs]</a><span class="nd">@admin</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s2">&quot;/delete/user&quot;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="s2">&quot;POST&quot;</span><span class="p">))</span>
<span class="nd">@login_required</span>
<span class="k">def</span> <span class="nf">delete_user</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This lets the admin user delete users -- it is never called directly as a view but only by a button.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">type</span> <span class="o">!=</span> <span class="s2">&quot;Admin&quot;</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;Access Denied&quot;</span>    
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;user_type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
        <span class="n">requests</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="s2">&quot;http://127.0.0.1:8080/bookings/remove/customer?customer_id=&quot;</span> <span class="o">+</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;user_id&quot;</span><span class="p">])</span>
        <span class="n">requests</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="s2">&quot;http://127.0.0.1:8080/customers/delete?id=&quot;</span> <span class="o">+</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;user_id&quot;</span><span class="p">])</span>
    <span class="k">elif</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;user_type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Engineer&quot;</span><span class="p">:</span>
        <span class="n">requests</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="s2">&quot;http://127.0.0.1:8080/backlogs/remove/signed/engineer?id=&quot;</span> <span class="o">+</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;user_id&quot;</span><span class="p">])</span>
        <span class="n">requests</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="s2">&quot;http://127.0.0.1:8080/backlogs/remove/assigned/engineer?id=&quot;</span> <span class="o">+</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;user_id&quot;</span><span class="p">])</span>
        <span class="n">requests</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="s2">&quot;http://127.0.0.1:8080/staffs/delete?id=&quot;</span> <span class="o">+</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;user_id&quot;</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">requests</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="s2">&quot;http://127.0.0.1:8080/staffs/delete?id=&quot;</span> <span class="o">+</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;user_id&quot;</span><span class="p">])</span>
    <span class="n">flash</span><span class="p">(</span><span class="s2">&quot;User deleted!&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s2">&quot;admin.user_view&quot;</span><span class="p">))</span></div>

<div class="viewcode-block" id="car_view"><a class="viewcode-back" href="../../User%20Interface.html#flaskr.admin.car_view">[docs]</a><span class="nd">@admin</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s2">&quot;/cars&quot;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="s2">&quot;POST&quot;</span><span class="p">))</span>
<span class="nd">@login_required</span>
<span class="k">def</span> <span class="nf">car_view</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is the car search function for Admin users. If you access it via GET request, we assume you are arriving for the first time and display a search form with no listed cars. If you access it via POST request, we assume you&#39;ve completed the search form and instead return both the search form and a table with results. Only Admin has access.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">type</span> <span class="o">!=</span> <span class="s2">&quot;Admin&quot;</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;Access Denied&quot;</span>
    <span class="n">form</span> <span class="o">=</span> <span class="n">AdminCarSearchForm</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;POST&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">search_car</span><span class="p">(</span><span class="n">form</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">display_all_cars</span><span class="p">(</span><span class="n">form</span><span class="p">)</span></div>

<div class="viewcode-block" id="search_car"><a class="viewcode-back" href="../../User%20Interface.html#flaskr.admin.search_car">[docs]</a><span class="k">def</span> <span class="nf">search_car</span><span class="p">(</span><span class="n">form</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This is the control logic that receives data from WTForms and returns cars.&quot;&quot;&quot;</span>
    <span class="n">brand</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s1">&#39;brand&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="n">car_type</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s1">&#39;car_type&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="n">color</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s1">&#39;color&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="n">seat</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s1">&#39;seat&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="n">cost</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s1">&#39;cost&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="n">mac_address</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s1">&#39;mac_address&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">Booking</span><span class="o">.</span><span class="n">validate_cost</span><span class="p">(</span><span class="n">cost</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">display_all_cars</span><span class="p">(</span><span class="n">form</span><span class="p">)</span>
    <span class="n">cars</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
        <span class="s2">&quot;http://127.0.0.1:8080/cars/read?brand=</span><span class="si">{}</span><span class="s2">&amp;type=</span><span class="si">{}</span><span class="s2">&amp;color=</span><span class="si">{}</span><span class="s2">&amp;seat=</span><span class="si">{}</span><span class="s2">&amp;cost=</span><span class="si">{}</span><span class="s2">&amp;mac_address=</span><span class="si">{}</span><span class="s2">&quot;</span>
        <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">brand</span><span class="p">,</span> <span class="n">car_type</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">seat</span><span class="p">,</span> <span class="n">cost</span><span class="p">,</span> <span class="n">mac_address</span><span class="p">)</span>
    <span class="p">)</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s2">&quot;admin/car_view.html&quot;</span><span class="p">,</span> <span class="n">cars</span><span class="o">=</span><span class="n">cars</span><span class="p">,</span> <span class="n">form</span><span class="o">=</span><span class="n">form</span><span class="p">)</span></div>

<div class="viewcode-block" id="display_all_cars"><a class="viewcode-back" href="../../User%20Interface.html#flaskr.admin.display_all_cars">[docs]</a><span class="k">def</span> <span class="nf">display_all_cars</span><span class="p">(</span><span class="n">form</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;If no search fields are filled or under certain errors, we show all users with this function.&quot;&quot;&quot;</span>
    <span class="n">cars</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
        <span class="s2">&quot;http://127.0.0.1:8080/cars/read?&quot;</span>
    <span class="p">)</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s2">&quot;admin/car_view.html&quot;</span><span class="p">,</span> <span class="n">cars</span><span class="o">=</span><span class="n">cars</span><span class="p">,</span> <span class="n">form</span><span class="o">=</span><span class="n">form</span><span class="p">)</span></div>

<div class="viewcode-block" id="car_bookings"><a class="viewcode-back" href="../../User%20Interface.html#flaskr.admin.car_bookings">[docs]</a><span class="nd">@admin</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s2">&quot;/car/bookings&quot;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="s2">&quot;POST&quot;</span><span class="p">))</span>
<span class="nd">@login_required</span>
<span class="k">def</span> <span class="nf">car_bookings</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This gets all bookings for a given car. It&#39;s accessed by pressing a button on the admin car search page.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">type</span> <span class="o">!=</span> <span class="s2">&quot;Admin&quot;</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;Access Denied&quot;</span>
    <span class="n">bookings</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;http://127.0.0.1:8080/cars/history?id=</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;car_id&quot;</span><span class="p">]))</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s2">&quot;admin/car_bookings.html&quot;</span><span class="p">,</span> <span class="n">bookings</span><span class="o">=</span><span class="n">bookings</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;car_id&quot;</span><span class="p">])</span></div>

<div class="viewcode-block" id="create_car"><a class="viewcode-back" href="../../User%20Interface.html#flaskr.admin.create_car">[docs]</a><span class="nd">@admin</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s2">&quot;/create/car&quot;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="s2">&quot;POST&quot;</span><span class="p">))</span>
<span class="nd">@login_required</span>
<span class="k">def</span> <span class="nf">create_car</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;This loads a form for the admin user to create a new car&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">type</span> <span class="o">!=</span> <span class="s2">&quot;Admin&quot;</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;Access Denied&quot;</span>
    <span class="n">form</span> <span class="o">=</span> <span class="n">AdminCreateCarForm</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;POST&quot;</span><span class="p">:</span>
        <span class="n">mac_address</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s2">&quot;mac_address&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="n">brand</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s2">&quot;brand&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="n">car_type</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s2">&quot;car_type&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="n">color</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s2">&quot;color&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="n">seat</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s2">&quot;seat&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="n">location_id</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s2">&quot;location_id&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="n">cost</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s2">&quot;cost&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="n">car</span> <span class="o">=</span> <span class="n">Car</span><span class="p">(</span><span class="n">brand</span><span class="p">,</span> <span class="n">car_type</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">seat</span><span class="p">,</span> <span class="n">cost</span><span class="p">,</span> <span class="n">location_id</span><span class="p">,</span> <span class="n">mac_address</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">car</span><span class="o">.</span><span class="n">validate_new_car</span><span class="p">():</span>
            <span class="n">car</span><span class="o">.</span><span class="n">create_car</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s2">&quot;admin.car_view&quot;</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s2">&quot;admin/car_detail.html&quot;</span><span class="p">,</span> <span class="n">form</span><span class="o">=</span><span class="n">form</span><span class="p">)</span></div>

<div class="viewcode-block" id="update_car"><a class="viewcode-back" href="../../User%20Interface.html#flaskr.admin.update_car">[docs]</a><span class="nd">@admin</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s2">&quot;/update/car&quot;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="s2">&quot;POST&quot;</span><span class="p">))</span>
<span class="nd">@login_required</span>
<span class="k">def</span> <span class="nf">update_car</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;On POST request, this creates a car. On GET, it returns a form to fill out to update a car. Parameters:</span>
<span class="sd">    </span>
<span class="sd">    car_id: The id of the car to update.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">g</span><span class="o">.</span><span class="n">type</span> <span class="o">!=</span> <span class="s2">&quot;Admin&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;Access Denied&quot;</span>
    <span class="n">form</span> <span class="o">=</span> <span class="n">AdminUpdateCarForm</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;POST&quot;</span><span class="p">:</span>
        <span class="n">mac_address</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s2">&quot;mac_address&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="n">brand</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s2">&quot;brand&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="n">car_type</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s2">&quot;car_type&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="n">color</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s2">&quot;color&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="n">seat</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s2">&quot;seat&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="n">location_id</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s2">&quot;location_id&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="n">cost</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s2">&quot;cost&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="n">status</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="n">car</span> <span class="o">=</span> <span class="n">Car</span><span class="p">(</span><span class="n">brand</span><span class="p">,</span> <span class="n">car_type</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">seat</span><span class="p">,</span> <span class="n">cost</span><span class="p">,</span> <span class="n">location_id</span><span class="p">,</span> <span class="n">mac_address</span><span class="p">,</span> <span class="n">status</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">car</span><span class="o">.</span><span class="n">validate_update_car</span><span class="p">():</span>
            <span class="n">car</span><span class="o">.</span><span class="n">update_car</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;car_id&quot;</span><span class="p">])</span>
            <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s2">&quot;admin.car_view&quot;</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s2">&quot;admin/car_detail.html&quot;</span><span class="p">,</span> <span class="n">car_id</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;car_id&quot;</span><span class="p">],</span> <span class="n">form</span><span class="o">=</span><span class="n">form</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;update&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="delete_car"><a class="viewcode-back" href="../../User%20Interface.html#flaskr.admin.delete_car">[docs]</a><span class="nd">@admin</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s2">&quot;/delete/car&quot;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;POST&quot;</span><span class="p">,</span><span class="s2">&quot;GET&quot;</span><span class="p">))</span>
<span class="nd">@login_required</span>
<span class="k">def</span> <span class="nf">delete_car</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This deletes a car. Parameters:</span>
<span class="sd">    </span>
<span class="sd">    car_id: The id of the car to delete</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">type</span> <span class="o">!=</span> <span class="s2">&quot;Admin&quot;</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;Access Denied&quot;</span>
    <span class="n">requests</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="s2">&quot;http://127.0.0.1:8080/backlogs/remove/car?car_id=&quot;</span> <span class="o">+</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;car_id&quot;</span><span class="p">])</span>
    <span class="n">requests</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="s2">&quot;http://127.0.0.1:8080/bookings/remove/car?car_id=&quot;</span> <span class="o">+</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;car_id&quot;</span><span class="p">])</span>
    <span class="n">requests</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="s2">&quot;http://127.0.0.1:8080/cars/delete?id=&quot;</span> <span class="o">+</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;car_id&quot;</span><span class="p">])</span>
    <span class="n">flash</span><span class="p">(</span><span class="s2">&quot;Car deleted!&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s2">&quot;admin.car_view&quot;</span><span class="p">))</span></div>

<div class="viewcode-block" id="report_car"><a class="viewcode-back" href="../../User%20Interface.html#flaskr.admin.report_car">[docs]</a><span class="nd">@admin</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s2">&quot;/report/car&quot;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;POST&quot;</span><span class="p">,</span><span class="s2">&quot;GET&quot;</span><span class="p">))</span>
<span class="nd">@login_required</span>
<span class="k">def</span> <span class="nf">report_car</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This flags a car to be repaired by an engineer. Accessed by searching for a car, then selecting the update button.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">type</span> <span class="o">!=</span> <span class="s2">&quot;Admin&quot;</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;Access Denied&quot;</span>
    <span class="n">car</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;http://127.0.0.1:8080/cars/read?id=&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;car_id&quot;</span><span class="p">]))</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">engineer</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;http://127.0.0.1:8080/staffs/read?user_type=engineer&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">form</span> <span class="o">=</span> <span class="n">NewBacklogForm</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;POST&quot;</span><span class="p">:</span>
        <span class="n">description</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s2">&quot;description&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="n">requests</span><span class="o">.</span><span class="n">put</span><span class="p">(</span>
            <span class="s2">&quot;http://127.0.0.1:8080/cars/update?status=To be repaired&quot;</span> <span class="o">+</span>
            <span class="s2">&quot;&amp;discription=&quot;</span> <span class="o">+</span> <span class="n">description</span> <span class="o">+</span>
            <span class="s2">&quot;&amp;id=&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;car_id&quot;</span><span class="p">])</span>
        <span class="p">)</span>
        <span class="n">send_email</span><span class="p">(</span><span class="n">engineer</span><span class="p">[</span><span class="s2">&quot;Email&quot;</span><span class="p">],</span> <span class="nb">str</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;car_id&quot;</span><span class="p">]),</span> <span class="n">description</span><span class="p">)</span>
        <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s2">&quot;http://127.0.0.1:8080/backlogs/create?assigned_engineer_id=</span><span class="si">{}</span><span class="s2">&amp;car_id=</span><span class="si">{}</span><span class="s2">&amp;status=Not</span><span class="si">%20d</span><span class="s2">one&amp;description=</span><span class="si">{}</span><span class="s2">&quot;</span>
                <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">engineer</span><span class="p">[</span><span class="s2">&quot;ID&quot;</span><span class="p">]),</span> <span class="nb">str</span><span class="p">(</span><span class="n">car</span><span class="p">[</span><span class="s2">&quot;ID&quot;</span><span class="p">]),</span> <span class="nb">str</span><span class="p">(</span><span class="n">description</span><span class="p">)))</span>
        <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s2">&quot;admin.car_view&quot;</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s2">&quot;admin/confirm_report.html&quot;</span><span class="p">,</span> <span class="n">form</span><span class="o">=</span><span class="n">form</span><span class="p">,</span> <span class="n">car</span><span class="o">=</span><span class="n">car</span><span class="p">,</span> <span class="n">engineer</span><span class="o">=</span><span class="n">engineer</span><span class="p">)</span></div>
     
<div class="viewcode-block" id="send_email"><a class="viewcode-back" href="../../User%20Interface.html#flaskr.admin.send_email">[docs]</a><span class="k">def</span> <span class="nf">send_email</span><span class="p">(</span><span class="n">receiver</span><span class="p">,</span> <span class="n">car_id</span><span class="p">,</span> <span class="n">description</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This sends out an email to an engineer when a new repair request is made. We used a HTML email template from [https://github.com/leemunroe/responsive-html-email-template] and modified it with the input to this function. Parameters:</span>
<span class="sd">    </span>
<span class="sd">    receiver: Email address of the person receiving the email. </span>
<span class="sd">    car_id: The car_id that needs repair</span>
<span class="sd">    description: A short description of the repairs to make.</span>
<span class="sd">    </span>
<span class="sd">    Note that the sending address needs to have &#39;allow less secure&#39; authentication methods enabled in Gmail so that it can use smtp authentication instead of OAuth2.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">message</span> <span class="o">=</span> <span class="n">MIMEMultipart</span><span class="p">(</span><span class="s2">&quot;alternative&quot;</span><span class="p">)</span>
    <span class="n">message</span><span class="p">[</span><span class="s2">&quot;Subject&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Car Maintenance Request&quot;</span>
    <span class="n">message</span><span class="p">[</span><span class="s2">&quot;From&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;ahjhj24012000@gmail.com&quot;</span>
    <span class="n">message</span><span class="p">[</span><span class="s2">&quot;To&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">receiver</span>
    <span class="c1"># Create the plain-text and HTML version of your message</span>
    <span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">    Hi,</span>
<span class="s2">    How are you?&quot;&quot;&quot;</span>
    <span class="n">html</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">    &lt;!doctype html&gt;</span>
<span class="s2">    &lt;html&gt;</span>
<span class="s2">    &lt;head&gt;</span>
<span class="s2">        &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width&quot; /&gt;</span>
<span class="s2">        &lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=UTF-8&quot; /&gt;</span>
<span class="s2">        &lt;title&gt;Simple Transactional Email&lt;/title&gt;</span>
<span class="s2">        &lt;style&gt;</span>
<span class="s2">        /* -------------------------------------</span>
<span class="s2">            GLOBAL RESETS</span>
<span class="s2">        ------------------------------------- */</span>
<span class="s2">        </span>
<span class="s2">        /*All the styling goes here*/</span>
<span class="s2">        </span>
<span class="s2">        img {</span>
<span class="s2">            border: none;</span>
<span class="s2">            -ms-interpolation-mode: bicubic;</span>
<span class="s2">            max-width: 100%; </span>
<span class="s2">        }</span>

<span class="s2">        body {</span>
<span class="s2">            background-color: #f6f6f6;</span>
<span class="s2">            font-family: sans-serif;</span>
<span class="s2">            -webkit-font-smoothing: antialiased;</span>
<span class="s2">            font-size: 14px;</span>
<span class="s2">            line-height: 1.4;</span>
<span class="s2">            margin: 0;</span>
<span class="s2">            padding: 0;</span>
<span class="s2">            -ms-text-size-adjust: 100%;</span>
<span class="s2">            -webkit-text-size-adjust: 100%; </span>
<span class="s2">        }</span>

<span class="s2">        table {</span>
<span class="s2">            border-collapse: separate;</span>
<span class="s2">            mso-table-lspace: 0pt;</span>
<span class="s2">            mso-table-rspace: 0pt;</span>
<span class="s2">            width: 100%; }</span>
<span class="s2">            table td {</span>
<span class="s2">            font-family: sans-serif;</span>
<span class="s2">            font-size: 14px;</span>
<span class="s2">            vertical-align: top; </span>
<span class="s2">        }</span>

<span class="s2">        /* -------------------------------------</span>
<span class="s2">            BODY &amp; CONTAINER</span>
<span class="s2">        ------------------------------------- */</span>

<span class="s2">        .body {</span>
<span class="s2">            background-color: #f6f6f6;</span>
<span class="s2">            width: 100%; </span>
<span class="s2">        }</span>

<span class="s2">        /* Set a max-width, and make it display as block so it will automatically stretch to that width, but will also shrink down on a phone or something */</span>
<span class="s2">        .container {</span>
<span class="s2">            display: block;</span>
<span class="s2">            margin: 0 auto !important;</span>
<span class="s2">            /* makes it centered */</span>
<span class="s2">            max-width: 580px;</span>
<span class="s2">            padding: 10px;</span>
<span class="s2">            width: 580px; </span>
<span class="s2">        }</span>

<span class="s2">        /* This should also be a block element, so that it will fill 100</span><span class="si">% o</span><span class="s2">f the .container */</span>
<span class="s2">        .content {</span>
<span class="s2">            box-sizing: border-box;</span>
<span class="s2">            display: block;</span>
<span class="s2">            margin: 0 auto;</span>
<span class="s2">            max-width: 580px;</span>
<span class="s2">            padding: 10px; </span>
<span class="s2">        }</span>

<span class="s2">        /* -------------------------------------</span>
<span class="s2">            HEADER, FOOTER, MAIN</span>
<span class="s2">        ------------------------------------- */</span>
<span class="s2">        .main {</span>
<span class="s2">            background: #ffffff;</span>
<span class="s2">            border-radius: 3px;</span>
<span class="s2">            width: 100%; </span>
<span class="s2">        }</span>

<span class="s2">        .wrapper {</span>
<span class="s2">            box-sizing: border-box;</span>
<span class="s2">            padding: 20px; </span>
<span class="s2">        }</span>

<span class="s2">        .content-block {</span>
<span class="s2">            padding-bottom: 10px;</span>
<span class="s2">            padding-top: 10px;</span>
<span class="s2">        }</span>

<span class="s2">        .footer {</span>
<span class="s2">            clear: both;</span>
<span class="s2">            margin-top: 10px;</span>
<span class="s2">            text-align: center;</span>
<span class="s2">            width: 100%; </span>
<span class="s2">        }</span>
<span class="s2">            .footer td,</span>
<span class="s2">            .footer p,</span>
<span class="s2">            .footer span,</span>
<span class="s2">            .footer a {</span>
<span class="s2">            color: #999999;</span>
<span class="s2">            font-size: 12px;</span>
<span class="s2">            text-align: center; </span>
<span class="s2">        }</span>

<span class="s2">        /* -------------------------------------</span>
<span class="s2">            TYPOGRAPHY</span>
<span class="s2">        ------------------------------------- */</span>
<span class="s2">        h1,</span>
<span class="s2">        h2,</span>
<span class="s2">        h3,</span>
<span class="s2">        h4 {</span>
<span class="s2">            color: #000000;</span>
<span class="s2">            font-family: sans-serif;</span>
<span class="s2">            font-weight: 400;</span>
<span class="s2">            line-height: 1.4;</span>
<span class="s2">            margin: 0;</span>
<span class="s2">            margin-bottom: 30px; </span>
<span class="s2">        }</span>

<span class="s2">        h1 {</span>
<span class="s2">            font-size: 35px;</span>
<span class="s2">            font-weight: 300;</span>
<span class="s2">            text-align: center;</span>
<span class="s2">            text-transform: capitalize; </span>
<span class="s2">        }</span>

<span class="s2">        p,</span>
<span class="s2">        ul,</span>
<span class="s2">        ol {</span>
<span class="s2">            font-family: sans-serif;</span>
<span class="s2">            font-size: 14px;</span>
<span class="s2">            font-weight: normal;</span>
<span class="s2">            margin: 0;</span>
<span class="s2">            margin-bottom: 15px; </span>
<span class="s2">        }</span>
<span class="s2">            p li,</span>
<span class="s2">            ul li,</span>
<span class="s2">            ol li {</span>
<span class="s2">            list-style-position: inside;</span>
<span class="s2">            margin-left: 5px; </span>
<span class="s2">        }</span>

<span class="s2">        a {</span>
<span class="s2">            color: #3498db;</span>
<span class="s2">            text-decoration: underline; </span>
<span class="s2">        }</span>

<span class="s2">        /* -------------------------------------</span>
<span class="s2">            BUTTONS</span>
<span class="s2">        ------------------------------------- */</span>
<span class="s2">        .btn {</span>
<span class="s2">            box-sizing: border-box;</span>
<span class="s2">            width: 100%; }</span>
<span class="s2">            .btn &gt; tbody &gt; tr &gt; td {</span>
<span class="s2">            padding-bottom: 15px; }</span>
<span class="s2">            .btn table {</span>
<span class="s2">            width: auto; </span>
<span class="s2">        }</span>
<span class="s2">            .btn table td {</span>
<span class="s2">            background-color: #ffffff;</span>
<span class="s2">            border-radius: 5px;</span>
<span class="s2">            text-align: center; </span>
<span class="s2">        }</span>
<span class="s2">            .btn a {</span>
<span class="s2">            background-color: #ffffff;</span>
<span class="s2">            border: solid 1px #3498db;</span>
<span class="s2">            border-radius: 5px;</span>
<span class="s2">            box-sizing: border-box;</span>
<span class="s2">            color: #3498db;</span>
<span class="s2">            cursor: pointer;</span>
<span class="s2">            display: inline-block;</span>
<span class="s2">            font-size: 14px;</span>
<span class="s2">            font-weight: bold;</span>
<span class="s2">            margin: 0;</span>
<span class="s2">            padding: 12px 25px;</span>
<span class="s2">            text-decoration: none;</span>
<span class="s2">            text-transform: capitalize; </span>
<span class="s2">        }</span>

<span class="s2">        .btn-primary table td {</span>
<span class="s2">            background-color: #3498db; </span>
<span class="s2">        }</span>

<span class="s2">        .btn-primary a {</span>
<span class="s2">            background-color: #3498db;</span>
<span class="s2">            border-color: #3498db;</span>
<span class="s2">            color: #ffffff; </span>
<span class="s2">        }</span>

<span class="s2">        /* -------------------------------------</span>
<span class="s2">            OTHER STYLES THAT MIGHT BE USEFUL</span>
<span class="s2">        ------------------------------------- */</span>
<span class="s2">        .last {</span>
<span class="s2">            margin-bottom: 0; </span>
<span class="s2">        }</span>

<span class="s2">        .first {</span>
<span class="s2">            margin-top: 0; </span>
<span class="s2">        }</span>

<span class="s2">        .align-center {</span>
<span class="s2">            text-align: center; </span>
<span class="s2">        }</span>

<span class="s2">        .align-right {</span>
<span class="s2">            text-align: right; </span>
<span class="s2">        }</span>

<span class="s2">        .align-left {</span>
<span class="s2">            text-align: left; </span>
<span class="s2">        }</span>

<span class="s2">        .clear {</span>
<span class="s2">            clear: both; </span>
<span class="s2">        }</span>

<span class="s2">        .mt0 {</span>
<span class="s2">            margin-top: 0; </span>
<span class="s2">        }</span>

<span class="s2">        .mb0 {</span>
<span class="s2">            margin-bottom: 0; </span>
<span class="s2">        }</span>

<span class="s2">        .preheader {</span>
<span class="s2">            color: transparent;</span>
<span class="s2">            display: none;</span>
<span class="s2">            height: 0;</span>
<span class="s2">            max-height: 0;</span>
<span class="s2">            max-width: 0;</span>
<span class="s2">            opacity: 0;</span>
<span class="s2">            overflow: hidden;</span>
<span class="s2">            mso-hide: all;</span>
<span class="s2">            visibility: hidden;</span>
<span class="s2">            width: 0; </span>
<span class="s2">        }</span>

<span class="s2">        .powered-by a {</span>
<span class="s2">            text-decoration: none; </span>
<span class="s2">        }</span>

<span class="s2">        hr {</span>
<span class="s2">            border: 0;</span>
<span class="s2">            border-bottom: 1px solid #f6f6f6;</span>
<span class="s2">            margin: 20px 0; </span>
<span class="s2">        }</span>

<span class="s2">        /* -------------------------------------</span>
<span class="s2">            RESPONSIVE AND MOBILE FRIENDLY STYLES</span>
<span class="s2">        ------------------------------------- */</span>
<span class="s2">        @media only screen and (max-width: 620px) {</span>
<span class="s2">            table[class=body] h1 {</span>
<span class="s2">            font-size: 28px !important;</span>
<span class="s2">            margin-bottom: 10px !important; </span>
<span class="s2">            }</span>
<span class="s2">            table[class=body] p,</span>
<span class="s2">            table[class=body] ul,</span>
<span class="s2">            table[class=body] ol,</span>
<span class="s2">            table[class=body] td,</span>
<span class="s2">            table[class=body] span,</span>
<span class="s2">            table[class=body] a {</span>
<span class="s2">            font-size: 16px !important; </span>
<span class="s2">            }</span>
<span class="s2">            table[class=body] .wrapper,</span>
<span class="s2">            table[class=body] .article {</span>
<span class="s2">            padding: 10px !important; </span>
<span class="s2">            }</span>
<span class="s2">            table[class=body] .content {</span>
<span class="s2">            padding: 0 !important; </span>
<span class="s2">            }</span>
<span class="s2">            table[class=body] .container {</span>
<span class="s2">            padding: 0 !important;</span>
<span class="s2">            width: 100% !important; </span>
<span class="s2">            }</span>
<span class="s2">            table[class=body] .main {</span>
<span class="s2">            border-left-width: 0 !important;</span>
<span class="s2">            border-radius: 0 !important;</span>
<span class="s2">            border-right-width: 0 !important; </span>
<span class="s2">            }</span>
<span class="s2">            table[class=body] .btn table {</span>
<span class="s2">            width: 100% !important; </span>
<span class="s2">            }</span>
<span class="s2">            table[class=body] .btn a {</span>
<span class="s2">            width: 100% !important; </span>
<span class="s2">            }</span>
<span class="s2">            table[class=body] .img-responsive {</span>
<span class="s2">            height: auto !important;</span>
<span class="s2">            max-width: 100% !important;</span>
<span class="s2">            width: auto !important; </span>
<span class="s2">            }</span>
<span class="s2">        }</span>

<span class="s2">        /* -------------------------------------</span>
<span class="s2">            PRESERVE THESE STYLES IN THE HEAD</span>
<span class="s2">        ------------------------------------- */</span>
<span class="s2">        @media all {</span>
<span class="s2">            .ExternalClass {</span>
<span class="s2">            width: 100%; </span>
<span class="s2">            }</span>
<span class="s2">            .ExternalClass,</span>
<span class="s2">            .ExternalClass p,</span>
<span class="s2">            .ExternalClass span,</span>
<span class="s2">            .ExternalClass font,</span>
<span class="s2">            .ExternalClass td,</span>
<span class="s2">            .ExternalClass div {</span>
<span class="s2">            line-height: 100%; </span>
<span class="s2">            }</span>
<span class="s2">            .apple-link a {</span>
<span class="s2">            color: inherit !important;</span>
<span class="s2">            font-family: inherit !important;</span>
<span class="s2">            font-size: inherit !important;</span>
<span class="s2">            font-weight: inherit !important;</span>
<span class="s2">            line-height: inherit !important;</span>
<span class="s2">            text-decoration: none !important; </span>
<span class="s2">            }</span>
<span class="s2">            #MessageViewBody a {</span>
<span class="s2">            color: inherit;</span>
<span class="s2">            text-decoration: none;</span>
<span class="s2">            font-size: inherit;</span>
<span class="s2">            font-family: inherit;</span>
<span class="s2">            font-weight: inherit;</span>
<span class="s2">            line-height: inherit;</span>
<span class="s2">            }</span>
<span class="s2">            .btn-primary table td:hover {</span>
<span class="s2">            background-color: #34495e !important; </span>
<span class="s2">            }</span>
<span class="s2">            .btn-primary a:hover {</span>
<span class="s2">            background-color: #34495e !important;</span>
<span class="s2">            border-color: #34495e !important; </span>
<span class="s2">            } </span>
<span class="s2">        }</span>

<span class="s2">        &lt;/style&gt;</span>
<span class="s2">    &lt;/head&gt;</span>
<span class="s2">    &lt;body class=&quot;&quot;&gt;</span>
<span class="s2">        &lt;span class=&quot;preheader&quot;&gt;This is preheader text. Some clients will show this text as a preview.&lt;/span&gt;</span>
<span class="s2">        &lt;table role=&quot;presentation&quot; border=&quot;0&quot; cellpadding=&quot;0&quot; cellspacing=&quot;0&quot; class=&quot;body&quot;&gt;</span>
<span class="s2">        &lt;tr&gt;</span>
<span class="s2">            &lt;td&gt;&amp;nbsp;&lt;/td&gt;</span>
<span class="s2">            &lt;td class=&quot;container&quot;&gt;</span>
<span class="s2">            &lt;div class=&quot;content&quot;&gt;</span>

<span class="s2">                &lt;!-- START CENTERED WHITE CONTAINER --&gt;</span>
<span class="s2">                &lt;table role=&quot;presentation&quot; class=&quot;main&quot;&gt;</span>

<span class="s2">                &lt;!-- START MAIN CONTENT AREA --&gt;</span>
<span class="s2">                &lt;tr&gt;</span>
<span class="s2">                    &lt;td class=&quot;wrapper&quot;&gt;</span>
<span class="s2">                    &lt;table role=&quot;presentation&quot; border=&quot;0&quot; cellpadding=&quot;0&quot; cellspacing=&quot;0&quot;&gt;</span>
<span class="s2">                        &lt;tr&gt;</span>
<span class="s2">                        &lt;td&gt;</span>
<span class="s2">                            &lt;p&gt;Hello engineer,&lt;/p&gt;</span>
<span class="s2">                            &lt;p&gt;Repairs have been requested for car #&quot;&quot;&quot;</span> <span class="o">+</span> <span class="n">car_id</span> <span class="o">+</span> <span class="s2">&quot; #&quot;</span><span class="o">+</span> <span class="n">description</span> <span class="o">+</span> <span class="s2">&quot;&quot;&quot;&lt;/p&gt;</span>
<span class="s2">                            &lt;table role=&quot;presentation&quot; border=&quot;0&quot; cellpadding=&quot;0&quot; cellspacing=&quot;0&quot; class=&quot;btn btn-primary&quot;&gt;</span>
<span class="s2">                            &lt;tbody&gt;</span>
<span class="s2">                                &lt;tr&gt;</span>
<span class="s2">                                &lt;td align=&quot;left&quot;&gt;</span>
<span class="s2">                                    &lt;table role=&quot;presentation&quot; border=&quot;0&quot; cellpadding=&quot;0&quot; cellspacing=&quot;0&quot;&gt;</span>
<span class="s2">                                    &lt;tbody&gt;</span>
<span class="s2">                                        &lt;tr&gt;</span>
<span class="s2">                                        &lt;td&gt; &lt;a href=</span><span class="se">\&quot;</span><span class="s2">&quot;&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;http://127.0.0.1:5000/auth/login&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;&quot;</span><span class="se">\&quot;</span><span class="s2"> target=&quot;_blank&quot;&gt;Click here to login&lt;/a&gt; &lt;/td&gt;</span>
<span class="s2">                                        &lt;/tr&gt;</span>
<span class="s2">                                    &lt;/tbody&gt;</span>
<span class="s2">                                    &lt;/table&gt;</span>
<span class="s2">                                &lt;/td&gt;</span>
<span class="s2">                                &lt;/tr&gt;</span>
<span class="s2">                            &lt;/tbody&gt;</span>
<span class="s2">                            &lt;/table&gt;</span>
<span class="s2">                            &lt;p&gt;Once logged in, you can see the car&#39;s location. Remember to mark the car as repaired when finished!&lt;/p&gt;</span>
<span class="s2">                            &lt;p&gt;Have a great day.&lt;/p&gt;</span>
<span class="s2">                        &lt;/td&gt;</span>
<span class="s2">                        &lt;/tr&gt;</span>
<span class="s2">                    &lt;/table&gt;</span>
<span class="s2">                    &lt;/td&gt;</span>
<span class="s2">                &lt;/tr&gt;</span>

<span class="s2">                &lt;!-- END MAIN CONTENT AREA --&gt;</span>
<span class="s2">                &lt;/table&gt;</span>
<span class="s2">                &lt;!-- END CENTERED WHITE CONTAINER --&gt;</span>

<span class="s2">                &lt;!-- START FOOTER --&gt;</span>
<span class="s2">                &lt;div class=&quot;footer&quot;&gt;</span>
<span class="s2">                &lt;table role=&quot;presentation&quot; border=&quot;0&quot; cellpadding=&quot;0&quot; cellspacing=&quot;0&quot;&gt;</span>
<span class="s2">                    &lt;tr&gt;</span>
<span class="s2">                    &lt;td class=&quot;content-block&quot;&gt;</span>
<span class="s2">                        &lt;span class=&quot;apple-link&quot;&gt;CloudCar, 123 Fake Street, HCMC Vietnam 700000&lt;/span&gt;</span>
<span class="s2">                        </span>
<span class="s2">                    &lt;/td&gt;</span>
<span class="s2">                    &lt;/tr&gt;</span>
<span class="s2">                    &lt;tr&gt;</span>
<span class="s2">                    &lt;td class=&quot;content-block powered-by&quot;&gt;</span>
<span class="s2">                        Powered by &lt;a href=&quot;https://github.com/leemunroe/responsive-html-email-template&quot;&gt;HTMLemail&lt;/a&gt;.</span>
<span class="s2">                    &lt;/td&gt;</span>
<span class="s2">                    &lt;/tr&gt;</span>
<span class="s2">                &lt;/table&gt;</span>
<span class="s2">                &lt;/div&gt;</span>
<span class="s2">                &lt;!-- END FOOTER --&gt;</span>

<span class="s2">                &lt;/div&gt;</span>
<span class="s2">                &lt;/td&gt;</span>
<span class="s2">                &lt;td&gt;&amp;nbsp;&lt;/td&gt;</span>
<span class="s2">            &lt;/tr&gt;</span>
<span class="s2">            &lt;/table&gt;</span>
<span class="s2">        &lt;/body&gt;</span>
<span class="s2">    &lt;/html&gt;</span>
<span class="s2">    &quot;&quot;&quot;</span>
    <span class="c1"># Turn these into plain/html MIMEText objects</span>
    <span class="n">part1</span> <span class="o">=</span> <span class="n">MIMEText</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="s2">&quot;plain&quot;</span><span class="p">)</span>
    <span class="n">part2</span> <span class="o">=</span> <span class="n">MIMEText</span><span class="p">(</span><span class="n">html</span><span class="p">,</span> <span class="s2">&quot;html&quot;</span><span class="p">)</span>

    <span class="c1"># Add HTML/plain-text parts to MIMEMultipart message</span>
    <span class="c1"># The email client will try to render the last part first</span>
    <span class="n">message</span><span class="o">.</span><span class="n">attach</span><span class="p">(</span><span class="n">part1</span><span class="p">)</span>
    <span class="n">message</span><span class="o">.</span><span class="n">attach</span><span class="p">(</span><span class="n">part2</span><span class="p">)</span>
    <span class="n">server</span> <span class="o">=</span> <span class="n">smtplib</span><span class="o">.</span><span class="n">SMTP</span><span class="p">(</span><span class="s2">&quot;smtp.gmail.com&quot;</span><span class="p">,</span> <span class="mi">587</span><span class="p">)</span>
    <span class="n">server</span><span class="o">.</span><span class="n">starttls</span><span class="p">()</span>
    <span class="n">server</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="s2">&quot;ahjhj24012000@gmail.com&quot;</span><span class="p">,</span> <span class="s2">&quot;quoc2401@&quot;</span><span class="p">)</span>
    <span class="n">server</span><span class="o">.</span><span class="n">sendmail</span><span class="p">(</span><span class="s2">&quot;ahjhj24012000@gmail.com&quot;</span><span class="p">,</span> <span class="s2">&quot;quoccuong242000@gmail.com&quot;</span><span class="p">,</span> <span class="n">message</span><span class="o">.</span><span class="n">as_string</span><span class="p">())</span></div>
</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h3><a href="../../index.html">Table of Contents</a></h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../Server.html">Server</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../API.html">API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Database.html">Database</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../User%20Interface.html">User Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Validators.html">Validators</a></li>
</ul>

<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2020, Minh Nguyen.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 3.2.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
    </div>

    

    
  </body>
</html>